# Prefix key
set -g prefix C-s
unbind C-b

# Default terminal
set-option -g default-terminal "tmux-256color"

# Default shell
set-option -g default-shell $SHELL
set-option -g default-command $SHELL

# Start window index at 1
set-option -g base-index 1

# Start pane index at 1
set-window-option -g pane-base-index 1

# Renumber windows when a window is closed
set-option -g renumber-windows on

# Status bar
set-option -g status on
set-option -g status-interval 2

# Scrollback history limit
set-option -g history-limit 5000

# Message display time (milliseconds)
set-option -g display-time 1000

# Terminal overrides for compatibility
# True color support
set-option -ga terminal-overrides ",xterm*:Tc"
# Disable alternate screen buffer (preserve scrollback)
set-option -ga terminal-overrides ",xterm*:smcup@:rmcup@"
# rxvt-unicode specific
set-option -ga terminal-overrides ',rxvt-uni*:XT:Ms=\E]52;%p1%s;%p2%s\007'
# UTF-8 ambiguous width characters
set-option -ga terminal-overrides ',*:U8=0'
# Cursor shape changes
set-option -ga terminal-overrides ',*:Ss=\E[%p1%d q:Se=\E[2 q'

# RGB color support
set -sa terminal-overrides ',xterm-256color:RGB'
# Undercurl support (wavy underline)
set -sa terminal-overrides ',*:Smulx=\E[4::%p1%dm'

# Vi mode keys in copy mode
set-window-option -g mode-keys vi
set-option -g default-command ""

# Clipboard settings
set-option -g set-clipboard on

# Activity monitoring
set-window-option -g monitor-activity on
set-option -g visual-activity off

# Bell settings
set-option -g bell-action other
set-option -g visual-bell off

# Escape time (for vim responsiveness)
set-option -s escape-time 20

# Pane synchronization (disabled by default)
set-option -g synchronize-panes off

# Mouse support
set-option -g mouse on

# Xterm keys
set-window-option -g xterm-keys on

# Status keys (emacs mode for command prompt)
set-option -g status-keys emacs

# Focus events
set-option -g focus-events on

# Aggressive resize
set-window-option -g aggressive-resize on

# Window title
set-option -g set-titles on
set-option -g set-titles-string '#T'
set-window-option -g automatic-rename on

# Word separators for double-click selection
set-option -g word-separators " -_()@,[]{}:=/"

# Environment
set-environment -g TMUX_DATA_DIR "${HOME}/.local/share/tmux"

#--------------------------------------------------------------#
##          Key Bindings                                      ##
#--------------------------------------------------------------#

# Quick pane/window navigation
bind 'C-\' run "tmux last-pane || tmux last-window || tmux new-window"
bind -n M-\; run "tmux last-pane || tmux last-window || tmux new-window"

# Detach
bind d detach

# Rename
bind A command-prompt "rename-window %%"
bind R command-prompt "rename-session %%"

# Choose window
bind C-w choose-window

# Select session/window/pane
bind -n M-Space choose-tree
bind -n M-a choose-tree
bind -n M-e choose-session
bind -n M-w choose-tree -w

# Reload configuration
bind r source-file ~/.config/tmux/tmux.conf \; display "Reloaded!"

# Split panes (maintain current path)
bind '\' split-window -hc "#{pane_current_path}"
bind -n 'M-\' split-window -hc "#{pane_current_path}"
bind - split-window -vc "#{pane_current_path}"
bind -n M-- split-window -vc "#{pane_current_path}"

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Arrow key pane navigation
bind -n S-left select-pane -L
bind -n S-down select-pane -D
bind -n S-up select-pane -U
bind -n S-right select-pane -R
bind -n M-S-left select-pane -L
bind -n M-S-down select-pane -D
bind -n M-S-up select-pane -U
bind -n M-S-right select-pane -R
bind -n M-H select-pane -L
bind -n M-J select-pane -D
bind -n M-K select-pane -U
bind -n M-L select-pane -R

# Window navigation
bind -n M-left previous-window
bind -n M-right next-window
bind -n M-up new-window -c "#{pane_current_path}"
bind -n M-down confirm-before 'kill-window'
bind -n M-h previous-window
bind -n M-l next-window
bind -n M-k new-window -c "#{pane_current_path}"
bind -n M-j confirm-before 'kill-window'
bind-key -n M-BSpace last-window

# Window number selection
bind-key -n M-1 select-window -t :=1
bind-key -n M-2 select-window -t :=2
bind-key -n M-3 select-window -t :=3
bind-key -n M-4 select-window -t :=4
bind-key -n M-5 select-window -t :=5
bind-key -n M-6 select-window -t :=6
bind-key -n M-7 select-window -t :=7
bind-key -n M-8 select-window -t :=8
bind-key -n M-9 select-window -t :=9
